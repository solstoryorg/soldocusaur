"use strict";(self.webpackChunksolstory=self.webpackChunksolstory||[]).push([[560],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return f}});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(n),f=i,h=d["".concat(c,".").concat(f)]||d[f]||p[f]||o;return n?r.createElement(h,a(a({ref:t},u),{},{components:n})):r.createElement(h,a({ref:t},u))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var l=2;l<o;l++)a[l]=n[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},883:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return c},default:function(){return f},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return p}});var r=n(7462),i=n(3366),o=(n(7294),n(3905)),a=["components"],s={sidebar_position:8},c="Advanced - Optimizations",l={unversionedId:"architecture/optimizations",id:"architecture/optimizations",title:"Advanced - Optimizations",description:"In designing an architcure for large scale data storage, it's crucial to keep",source:"@site/docs/architecture/optimizations.md",sourceDirName:"architecture",slug:"/architecture/optimizations",permalink:"/architecture/optimizations",editUrl:"https://github.com/solstoryorg/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/architecture/optimizations.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Reading",permalink:"/architecture/reading"},next:{title:"Costs & Fee Structure",permalink:"/costs_and_fees"}},u={},p=[{value:"Storage",id:"storage",level:2},{value:"Why CDNs",id:"why-cdns",level:2}],d={toc:p};function f(e){var t=e.components,n=(0,i.Z)(e,a);return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"advanced---optimizations"},"Advanced - Optimizations"),(0,o.kt)("p",null,"In designing an architcure for large scale data storage, it's crucial to keep\nin mind cost. Particularly if one of the problems you're trying to solve\nis the high cost of storing things for Solana programs on chain."),(0,o.kt)("h2",{id:"storage"},"Storage"),(0,o.kt)("p",null,"An individual story should have minimal on chain storage requirements, since\nrent exempt storage on chain quickly adds up. At $100 Sol a KB of on chain\nstorage costs roughly 80 cents. Cheap, except if you\u2019re trying to operate a\nwriter program on a 10k pfp nft set suddenly a single program costs $8000\nin capital allocation."),(0,o.kt)("p",null,"We can minimize this by putting everything universal to the writer into a\nseparate metadata PDA for the writer program as a whole, instead of a\nspecific program for each NFT. Then, we can cull any kind of reverse lookup\nability\u2013the PDA effectively lets us go from writer_key+nft_key->writerHeadPDA,\nso we can get away with using the PDA's own address as our two id fields (saving\n64 bytes!), and then store only the bare data we need for validation and lookup.\nBy structuring our hashing scheme so we only need a single 32 byte hash, storing\nurl lookup components in the metadata url (giving up some flexibility for folks\nnot wanting to use a permanent storage provider like ARDrive, but not in a permanently\ndestructive way, ",(0,o.kt)("a",{parentName:"p",href:"../usage/reconstruction"},"see reconstruction"),"), letting us cap\nour pointer to a single 32 byte id, and throw Anchor's 8 byte discriminator and\nsome permission flags and we get a tiny tiny 75 bytes. That's less data storage\nthan you would need in order to store this sentence."),(0,o.kt)("p",null,'The cost of this is that we lose the ability to do things like lookup "every\nwriterHeadPDA for nft_id". Which is important. But that\'s where CDNs come in.'),(0,o.kt)("h2",{id:"why-cdns"},"Why CDNs"),(0,o.kt)("p",null,"There\u2019s some irreducible complexity associated with a distributed programming infrastructure."),(0,o.kt)("p",null,"Without a CDN, you end up scanning the blockchain for every single possible writer\nprogram of an NFT, then again making as many individual web requests in serial\nfor the number of past records you want to display."),(0,o.kt)("p",null,"A CDN allows us to optimize this: we can use a single request to get every single\nhead for the NFT. Then we can use the same (or a different cdn, if the writer program\nspecifies) to get a large set of items at once, for a single web request."),(0,o.kt)("p",null,"Validation still works: we can either get the on-chain head in parallel to verify\nor trust that Solstory's centrally run CDN is being honest."))}f.isMDXComponent=!0}}]);